<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" class="no-js" lang="es">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>ReciCar - Búsqueda rápida de categoría</title>
    <meta name="description" content="Busca repuestos por categoría en ReciCar">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="assets/img/favicon.ico">

     <!-- CSS 
    ========================= -->
     <!--bootstrap min css-->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <!--owl carousel min css-->
    <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
    <!--slick min css-->
    <link rel="stylesheet" href="assets/css/slick.css">
    <!--magnific popup min css-->
    <link rel="stylesheet" href="assets/css/magnific-popup.css">
    <!--font awesome css-->
    <link rel="stylesheet" href="assets/css/font.awesome.css">
    <!--ionicons min css-->
    <link rel="stylesheet" href="assets/css/ionicons.min.css">
    <!--animate css-->
    <link rel="stylesheet" href="assets/css/animate.css">
    <!--jquery ui min css-->
    <link rel="stylesheet" href="assets/css/jquery-ui.min.css">
    <!--slinky menu css-->
    <link rel="stylesheet" href="assets/css/slinky.menu.css">
    <!-- Plugins CSS -->
    <link rel="stylesheet" href="assets/css/plugins.css">
    
    <!-- Main Style CSS -->
    <link rel="stylesheet" href="assets/css/style.css">
    
    <!--modernizr min js here-->
    <script src="assets/js/vendor/modernizr-3.7.1.min.js"></script>

    <style>
        .categories-page {
            background-color: #f8f9fa;
            min-height: 100vh;
        }
        
        .categories-header {
            background-color: #ffffff;
            padding: 40px 0 20px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .categories-title {
            font-size: 28px;
            font-weight: 600;
            color: #333333;
            margin: 0;
            text-align: left;
        }
        
        .categories-list {
            background-color: #f8f9fa;
            padding: 20px 0 40px 0;
        }
        
        .category-item {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            margin-bottom: 8px;
            background-color: #ffffff;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            text-decoration: none;
            color: #333333;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .category-item:hover {
            background-color: #f8f9fa;
            text-decoration: none;
            color: #333333;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .category-item.active {
            background-color: #fff3cd;
            border-color: #ffc107;
        }
        
        .category-item.active .category-name,
        .category-item.active .category-count,
        .category-item.active .category-expand {
            color: #ff8c00;
        }
        
        .category-icon {
            width: 24px;
            height: 24px;
            margin-right: 16px;
            color: #666666;
            flex-shrink: 0;
            font-size: 18px;
        }
        
        .category-name {
            flex: 1;
            font-size: 16px;
            font-weight: 500;
            color: #333333;
            margin: 0;
        }
        
        .category-count {
            font-size: 14px;
            color: #6c757d;
            margin-right: 12px;
            font-weight: 400;
        }
        
        .category-expand {
            width: 20px;
            height: 20px;
            color: #6c757d;
            flex-shrink: 0;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.2s ease;
        }
        
        .category-item.expanded .category-expand {
            transform: rotate(45deg);
        }
        
        .subcategories {
            display: none;
            background-color: #f8f9fa;
            border-left: 3px solid #ffc107;
            margin-left: 20px;
            margin-top: 8px;
            border-radius: 0 8px 8px 0;
        }
        
        .subcategories.show {
            display: block;
        }
        
        .subcategory-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            margin-bottom: 4px;
            background-color: #ffffff;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            text-decoration: none;
            color: #495057;
            transition: all 0.2s ease;
        }
        
        .subcategory-item:hover {
            background-color: #e9ecef;
            text-decoration: none;
            color: #495057;
        }
        
        .subcategory-name {
            flex: 1;
            font-size: 14px;
            font-weight: 400;
            margin: 0;
        }
        
        .subcategory-count {
            font-size: 12px;
            color: #6c757d;
            margin-right: 8px;
        }
        
        .container-custom {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .search-box {
            background-color: #ffffff;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        
        .search-box input {
            border: none;
            outline: none;
            flex: 1;
            font-size: 16px;
            color: #333333;
        }
        
        .search-box input::placeholder {
            color: #6c757d;
        }
        
        .search-icon {
            color: #6c757d;
            margin-right: 12px;
        }
        
        /* Products Section Styles */
        .products-section {
            background-color: #ffffff;
            border-radius: 8px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .products-header {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .products-header h2 {
            font-size: 24px;
            font-weight: 600;
            color: #333333;
            margin: 0 0 10px 0;
        }
        
        .products-count p {
            color: #6c757d;
            font-size: 14px;
            margin: 0;
        }
        
        .products-grid {
            margin-bottom: 30px;
        }
        
        .product-card {
            background-color: #ffffff;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            height: 100%;
        }
        
        .product-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .product-image {
            margin-bottom: 15px;
            text-align: center;
        }
        
        .product-image img {
            max-width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 4px;
        }
        
        .product-info {
            text-align: center;
        }
        
        .product-name {
            font-size: 16px;
            font-weight: 600;
            margin: 0 0 8px 0;
        }
        
        .product-name a {
            color: #333333;
            text-decoration: none;
        }
        
        .product-name a:hover {
            color: #007bff;
        }
        
        .product-category {
            font-size: 14px;
            color: #6c757d;
            margin: 0 0 10px 0;
        }
        
        .product-price {
            margin-top: 10px;
        }
        
        .current-price {
            font-size: 18px;
            font-weight: 600;
            color: #28a745;
        }
        
        .old-price {
            font-size: 14px;
            color: #6c757d;
            text-decoration: line-through;
            margin-left: 8px;
        }
        
        .no-products {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        
        .pagination-wrapper {
            margin-top: 30px;
            display: flex;
            justify-content: center;
        }
        
        .pagination {
            margin: 0;
        }
        
        .page-item.active .page-link {
            background-color: #007bff;
            border-color: #007bff;
        }
        
        .page-link {
            color: #007bff;
            border: 1px solid #dee2e6;
            padding: 8px 12px;
        }
        
        .page-link:hover {
            color: #0056b3;
            background-color: #e9ecef;
            border-color: #dee2e6;
        }
        
        .page-item.disabled .page-link {
            color: #6c757d;
            background-color: #fff;
            border-color: #dee2e6;
        }
    </style>
</head>

<body>
    <!-- Main Wrapper Start -->
    <!--header area start-->
    <th:block th:replace="fragments/_header :: header"></th:block>
    <!--header area end-->

    <!--Offcanvas menu area start-->
    <th:block th:replace="fragments/_offcanvasmenu :: offcanvasmenu"></th:block>
    <!--Offcanvas menu area end-->

    <!-- Categories Page Start -->
    <div class="categories-page">
        <div class="container-custom">
            <!-- Categories Header -->
            <div class="categories-header">
                <h1 class="categories-title">Búsqueda rápida de categoría</h1>
            </div>
            
            <!-- Search Box -->
            <div class="search-box">
                <i class="fa fa-search search-icon"></i>
                <input type="text" placeholder="Búsqueda rápida de categoría" id="categorySearch">
            </div>
            
            <!-- Categories List -->
            <div class="categories-list">
                <!-- Dynamic Categories from Backend -->
                <th:block th:each="category : ${categories}">
                    <th:block th:if="${category.parent == null}">
                        <a th:href="@{/search(category=${category.slug})}" class="category-item" th:attr="data-category=${category.slug}">
                            <div class="category-icon">
                                <i class="fa fa-cog"></i>
                            </div>
                            <h3 class="category-name" th:text="${category.name}">Category Name</h3>
                            <span class="category-count" th:text="${category.products.size()}">0</span>
                            <div class="category-expand" th:if="${!category.children.isEmpty()}">+</div>
                        </a>
                        <div class="subcategories" th:if="${!category.children.isEmpty()}" th:id="'subcategories-' + ${category.slug}">
                            <a th:each="subcategory : ${category.children}" 
                               th:href="@{/search(category=${subcategory.slug})}" 
                               class="subcategory-item">
                                <span class="subcategory-name" th:text="${subcategory.name}">Subcategory Name</span>
                                <span class="subcategory-count" th:text="${subcategory.products.size()}">0</span>
                            </a>
                        </div>
                    </th:block>
                </th:block>

                <!-- Fallback if no categories (keep one example for styling) -->
                <th:block th:if="${categories == null or categories.isEmpty()}">
                    <div class="category-item" data-category="caja-cambios-embrague-transmision">
                        <div class="category-icon">
                            <i class="fa fa-cogs"></i>
                        </div>
                        <h3 class="category-name">Caja de cambios/embrague/transmisión</h3>
                        <span class="category-count">6276</span>
                        <div class="category-expand">+</div>
                    </div>
                    <div class="subcategories" id="subcategories-caja-cambios-embrague-transmision">
                        <a href="#" class="subcategory-item">
                            <span class="subcategory-name">Caja de cambios manual de 5 velocidades</span>
                            <span class="subcategory-count">142</span>
                        </a>
                        <a href="#" class="subcategory-item">
                            <span class="subcategory-name">Caja de cambios manual de 6 velocidades</span>
                            <span class="subcategory-count">9</span>
                        </a>
                        <a href="#" class="subcategory-item">
                            <span class="subcategory-name">Caja de cambios automática</span>
                            <span class="subcategory-count">265</span>
                        </a>
                    </div>
                </th:block>
            </div>
            
            <!-- Products Section (shown when category is selected) -->
            <div th:if="${showProducts}" class="products-section">
                <div class="products-header">
                    <h2 th:if="${selectedCategory != null}" th:text="'Productos en ' + ${selectedCategory.name}">Productos en categoría</h2>
                    <div class="products-count" th:if="${page != null}">
                        <p th:text="'Mostrando ' + ${page.numberOfElements} + ' de ' + ${page.totalElements} + ' resultados'">
                            Mostrando 0 de 0 resultados
                        </p>
                    </div>
                </div>
                
                <!-- Error Message -->
                <div th:if="${errorMessage != null}" class="alert alert-warning" role="alert" th:text="${errorMessage}">
                    There was a problem with your search.
                </div>
                
                <!-- Products Grid -->
                <div class="row products-grid" th:if="${!products.isEmpty()}">
                    <div class="col-lg-4 col-md-6 col-sm-6" th:each="product : ${products}">
                        <div class="product-card">
                            <div class="product-image">
                                <a th:href="@{/product-details(id=${product.id})}">
                                    <img th:src="${product.primaryImage != null ? product.primaryImage.url : '/img/product/product10.jpg'}" 
                                         th:alt="${product.name}" class="img-fluid">
                                </a>
                            </div>
                            <div class="product-info">
                                <h3 class="product-name">
                                    <a th:href="@{/product-details(id=${product.id})}" th:text="${product.name}">Product Name</a>
                                </h3>
                                <p class="product-category" th:text="${product.category.name}">Category</p>
                                <div class="product-price">
                                    <span class="current-price" th:text="${product.formattedPrice}">$160.00</span>
                                    <span class="old-price" th:if="${product.oldPrice != null}" th:text="${#numbers.formatCurrency(product.oldPrice)}">$320.00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- No Products Message -->
                <div th:if="${products.isEmpty()}" class="no-products">
                    <p>No se encontraron productos en esta categoría.</p>
                </div>
                
                <!-- Pagination -->
                <div class="pagination-wrapper" th:if="${page != null and page.totalPages > 1}">
                    <nav aria-label="Product pagination">
                        <ul class="pagination">
                            <!-- Previous link -->
                            <li class="page-item" th:classappend="${!page.hasPrevious()} ? 'disabled' : ''">
                                <a class="page-link" th:if="${page.hasPrevious()}" 
                                   th:href="@{/search(category=${categorySlug}, page=${page.number-1})}">Anterior</a>
                                <span class="page-link" th:if="${!page.hasPrevious()}">Anterior</span>
                            </li>
                            
                            <!-- Page numbers -->
                            <li th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}" 
                                class="page-item" th:classappend="${i == page.number} ? 'active' : ''">
                                <a class="page-link" th:href="@{/search(category=${categorySlug}, page=${i})}" 
                                   th:text="${i + 1}">1</a>
                            </li>
                            
                            <!-- Next link -->
                            <li class="page-item" th:classappend="${!page.hasNext()} ? 'disabled' : ''">
                                <a class="page-link" th:if="${page.hasNext()}" 
                                   th:href="@{/search(category=${categorySlug}, page=${page.number+1})}">Siguiente</a>
                                <span class="page-link" th:if="${!page.hasNext()}">Siguiente</span>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
    <!-- Categories Page End -->

    <!--call to action start-->
    <th:block th:replace="fragments/_calltoaction :: calltoaction"></th:block>
    <!--call to action end-->

    <!--footer area start-->
    <th:block th:replace="fragments/_footer :: footer"></th:block>
    <!--footer area end-->

    <!-- JS
    ============================================ -->
    <!--jquery min js-->
    <script src="assets/js/vendor/jquery-3.4.1.min.js"></script>
    <!--popper min js-->
    <script src="assets/js/popper.js"></script>
    <!--bootstrap min js-->
    <script src="assets/js/bootstrap.min.js"></script>
    <!--owl carousel min js-->
    <script src="assets/js/owl.carousel.min.js"></script>
    <!--slick min js-->
    <script src="assets/js/slick.min.js"></script>
    <!--magnific popup min js-->
    <script src="assets/js/jquery.magnific-popup.min.js"></script>
    <!--jquery countdown min js-->
    <script src="assets/js/jquery.countdown.js"></script>
    <!--jquery ui min js-->
    <script src="assets/js/jquery.ui.js"></script>
    <!--jquery elevatezoom min js-->
    <script src="assets/js/jquery.elevatezoom.js"></script>
    <!--isotope packaged min js-->
    <script src="assets/js/isotope.pkgd.min.js"></script>
    <!--slinky menu js-->
    <script src="assets/js/slinky.menu.js"></script>
    <!-- Plugins JS -->
    <script src="assets/js/plugins.js"></script>

    <!-- Main JS -->
    <script src="assets/js/main.js"></script>

    <!-- Categories Page JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get all category items and search input
            const categoryItems = document.querySelectorAll('.category-item');
            const searchInput = document.getElementById('categorySearch');
            
            // Handle category expansion/collapse
            categoryItems.forEach(item => {
                const expandButton = item.querySelector('.category-expand');
                const categoryName = item.getAttribute('data-category');
                const subcategories = document.getElementById(`subcategories-${categoryName}`);
                
                // Click handler for category item
                item.addEventListener('click', function(e) {
                    // Don't trigger if clicking on subcategory links
                    if (e.target.closest('.subcategory-item')) {
                        return;
                    }
                    
                    // Toggle active state
                    categoryItems.forEach(cat => cat.classList.remove('active'));
                    item.classList.add('active');
                    
                    // Toggle expanded state
                    const isExpanded = item.classList.contains('expanded');
                    
                    // Close all other categories
                    categoryItems.forEach(cat => {
                        cat.classList.remove('expanded');
                        const catName = cat.getAttribute('data-category');
                        const catSubcategories = document.getElementById(`subcategories-${catName}`);
                        if (catSubcategories) {
                            catSubcategories.classList.remove('show');
                        }
                    });
                    
                    // Toggle current category
                    if (!isExpanded) {
                        item.classList.add('expanded');
                        if (subcategories) {
                            subcategories.classList.add('show');
                        }
                    }
                });
            });
            
            // Search functionality
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                
                categoryItems.forEach(item => {
                    const categoryName = item.querySelector('.category-name').textContent.toLowerCase();
                    const subcategories = item.nextElementSibling;
                    
                    if (categoryName.includes(searchTerm)) {
                        item.style.display = 'flex';
                        if (subcategories) {
                            subcategories.style.display = 'block';
                        }
                    } else {
                        item.style.display = 'none';
                        if (subcategories) {
                            subcategories.style.display = 'none';
                        }
                    }
                });
            });
            
            // Clear search on escape key
            searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    this.value = '';
                    categoryItems.forEach(item => {
                        item.style.display = 'flex';
                        const categoryName = item.getAttribute('data-category');
                        const subcategories = document.getElementById(`subcategories-${categoryName}`);
                        if (subcategories) {
                            subcategories.style.display = 'none';
                        }
                    });
                }
            });
        });
    </script>

</body>

</html>
